---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  # Coverage not implemented yet
  #- name: check-coverage
  #  image: node:12
  #  commands:
  #    - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - NPM_CONFIG_IGNORE_SCRIPTS=true npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: hr2SXxkMI45kSblE9cLwyp97UFM+wEVAiMvFcNlm+eIapiH54BgNh3uTWpDQ6xeVl3i2TZL1Oe9rk04+jF9FMg==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: cc1746f904d6ebb1c5991f4d0704d0db8bf3e518c3f42842e2005faceb783561

...
